<!DOCTYPE html>
<html style="background: #fff;">
<head>
    <meta charset=utf-8/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <!--<meta http-equiv="Cache-Control" content="no-cache">-->
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="full-screen" content="yes">
    <meta name="x5-fullscreen" content="true">
    <meta name="browsermode" content="application">
    <meta name="x5-page-mode" content="app">
    <link rel="icon" href="./images/fav.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="./css/global2.css">
    <link rel="stylesheet" href="./css/hearder.css">
    <script src="./js/rem/flexible.css.js"></script>
    <script src="./js/rem/flexible.ios.js"></script>
    <title>推广</title>
</head>
<body style="background: #fff;">
<header id="header" class="newHeader">
    <!--<div style="width: 1%;float: left"><</div>-->
    <div onclick="location='index.html'" class="logo">
        <img src="images/logo.png" style="height: 25px;margin-top: -10px;">
    </div>
    <div class="acctInfo">
        <div onclick="location='grzx.html'" class="logined">用户中心</div>
        <div onclick="location='index.html';oauth.clean()" class="loginOut">退出</div>
    </div>
</header>
<div id="content" style="margin-top: 48px;margin-bottom: 1.21875rem;">
    <img src="./images/tuiguangbanner.png" class="w100" alt="">
    <h3 class="tuiguangTitle">
        我要推广
    </h3>
    <table class="tgTypeTable">
        <tr>
            <td class="typeTitle tl">
                推广方式一:
            </td>
            <td class="typeCon tc">
                <div id="imagQrDiv" class="tgEWM" style="margin: 0 auto;">

                </div>
                <!--<img src="./images/ewm.png" class="tgEWM" id="imagQrDiv"  alt="">-->
                <p class="warmTips">温馨提示：发送您的二维码给好友，长按该二维码可注册。</p>
            </td>
        </tr>
        <tr>
            <td class="typeTitle tl">
                推广方式二:
            </td>
            <td class="typeCon tc">
                <p class="tgLink" id="url">登陆后生成推广链接</p>
                <div class="copyTgLink copy"><img class="feedBtn" src="./images/copyTgLinkBtn.png" alt=""></div>
                <p class="warmTips">温馨提示：点击复制此条链接发送给该好友。</p>
            </td>
        </tr>
        <tr>
            <td class="typeTitle tl">
                推广方式三:
            </td>
            <td class="typeCon tc">
                <div class="shareTg">
                    点击分享 <img class="feedBtn shareBtn" src="./images/shareBtn.png" alt="">可分享到朋友圈或指定好友
                </div>
            </td>
        </tr>
        <tr>
            <td class="typeTitle tl">
                已推广:
            </td>
            <td class="typeCon tc">
                <div class="tgNum tl">
                    <span class="numSz">0</span>人
                </div>
            </td>
        </tr>
    </table>
<div class="splitLine"></div>
    <h3 class="tuiguangTitle" style="border:none;">
        推广列表
    </h3>
    <table class="tgListTable">
        <tr class="tableHead">
            <td>
                ID
            </td>
            <td>
                用户名
            </td>
            <td>
                注册时间
            </td>
        </tr>
        <!--<tr>-->
            <!--<td>001</td>-->
            <!--<td>老刘来种田</td>-->
            <!--<td>2017-5-2 15:11:49</td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td>001</td>-->
            <!--<td>老刘来种田</td>-->
            <!--<td>2017-5-2 15:11:49</td>-->
        <!--</tr>-->
        <!--<tr>-->
            <!--<td>001</td>-->
            <!--<td>老刘来种田</td>-->
            <!--<td>2017-5-2 15:11:49</td>-->
        <!--</tr>-->
    </table>

    <!--<div class=" w100 ovhd" style="height: 100%">-->
        <!--<div style="width: 100%;padding: 0.3rem 3%">-->
            <!--<div style="width: 92%;background-color: #EEF6FD;line-height: 25px;padding: 0.3rem 1%; color: #53A0E3; border-radius: 3px;">-->
                <!--温馨提示：<br/>-->
                <!--1：通过您得推荐链接或二维码扫描注册得玩家，将成为你得亲密好友。<br/>2：您将得到该亲密好友收成得5%得奖励，同时并得到该亲密好友邀请得亲密好友-->
                <!--收成得2%得奖励。（如：A邀请B，B邀请C，C收获时，B将得到5%得收成，A将得到2%得收成）-->
            <!--</div>-->
        <!--</div>-->
        <!--<div style="width: 100%;">-->
            <!--<div style="width: 90%;margin: 0.3rem auto;">-->
                <!--<p><span style="font-size: 14px;color: red; font-weight: 900">方式一:</span><br/>点击复制按扭复制网址发送给朋友</p>-->
                <!--<div>-->
                    <!--<div style="width: 100%;background-color: #EFEFEF;padding: 5px 0;color: #FF6600; font-weight: 900;font-size: 0.35rem;"-->
                         <!--id="url"></div>-->
                    <!--<div style="width: 20%;text-align: center;margin:0.4rem 40% 0.4rem 40%;" class="copy"-->
                         <!--onclick="void(0);">-->
                        <!--<p style="padding: 0.1rem 0; border: solid 1px #8a8a8a ;color: #8a8a8a; width: 3rem;text-align: center;border-radius:4px">-->
                            <!--复制地址</p>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div style="width: 90%;margin: 0.3rem auto;"><p><span style="font-size: 14px;color: red; font-weight: 900">方式二:</span><br/>长按二维码，点击发送给朋友-->
            <!--</p>-->
                <!--<div style="width: 80%;border: solid 1px #EFEFEF;text-align: center;margin: 0.3rem 10% 0 10%;">-->

                    <!--<div style="width: 80%;margin: 0.4rem 10%;" id="imagQrDiv">-->


                    <!--</div>-->


                <!--</div>-->
            <!--</div>-->
        <!--</div>-->

        <!--<div style="width: 100%;padding: 0.3rem 3%">-->
            <!--<div style="width: 92%;background-color: #EEF6FD;line-height: 25px;padding: 0.3rem 1%; color: #999999; border-radius: 3px;">-->
                <!--使用说明：<br/>-->
                <!--1.复制上面的推广链接或二维码，并发送给好友。点击复制按扭可直接复制地址<br/>-->
                <!--2.好友通过链接或者扫码进入注册页面进行注册，将成为您的推广会员。<br/>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
</div>
<!--<footer id="footer" class="w100">-->
    <!--<div class="homeNav tc feedBtn">-->
        <!--<img src="./images/home_0.png" class="disbl" alt="" onclick="location='index.html'">-->
        <!--<p>游戏首页</p>-->
    <!--</div>-->
    <!--<div class="tuiguangNav tc feedBtn" onclick="return">-->
        <!--<img src="./images/new_anno.png" class="disbl" alt="">-->
        <!--<p>新闻公告</p>-->
    <!--</div>-->
    <!--<div class="myNav tc feedBtn" onclick="location='game-desc.html'">-->
        <!--<img src="./images/game_desc.png" class="disbl" alt="">-->
        <!--<p>游戏介绍</p>-->
    <!--</div>-->
    <!--<div class="myNav tc feedBtn active" onclick="return">-->
        <!--<img src="./images/person_0.png" class="disbl" alt="">-->
        <!--<p>个人中心</p>-->
    <!--</div>-->
<!--</footer>-->
<div class="backGame fixedIcon" onclick="Util.goGame()">
    <p>
        返回<br/>
        游戏
    </p>
</div>
<img src="./images/topTopIcon.png" class="toTopBtn feedBtn fixedIcon" onclick="window.location='#'" alt="">
<div id="qrcode" style="display: none"></div>
<script src="./js/jquery.min.js"></script>
<script src="./js/layer/layer.js"></script>
<script src="./js/jquery.qrcode.min.js"></script>
<script src="./js/myModule.js"></script>
<script src="./js/global.js"></script>
<script src="./js/common.js"></script>
<script src="./js/clipboard.js"></script>
</body>
</html>
<script>
    $(function () {
        ajaxHelper.get(urlMap.promoteUrl, {}, function (result) {
            if (result.success) {
                jQuery('#qrcode').qrcode({
                    width: 120,
                    height: 120,
                    text: result.obj
                });
                var mycanvas1 = document.getElementsByTagName('canvas')[0];

                //将转换后的img标签插入到html中

                var img = convertCanvasToImage(mycanvas1);

                $('#imagQrDiv').append(img);//imagQrDiv表示你要插入的容器id

                $("#url").html(result.obj);
                //getList();
            } else {
                oauth.clean();
                layer.msg(result.msg);
            }
        });


        function convertCanvasToImage(canvas) {
            //新Image对象，可以理解为DOM
            var image = new Image();
            // canvas.toDataURL 返回的是一串Base64编码的URL，当然,浏览器自己肯定支持
            // 指定格式 PNG
            image.src = canvas.toDataURL("image/png");
            image.style.height = '100%'
            image.style.width = '100%'
            return image;
        }


        var clipboard = new Clipboard('.copy', {
            text: function () {
                return $("#url").html();
            }
        });
        clipboard.on('success', function (e) {
            layer.msg("内容已经复制到剪贴板！");
            console.log(e);
        });

        clipboard.on('error', function (e) {
            layer.msg("复制失败，请重新复制！");
            console.log(e);
        });

        var h = parseInt($(window).width());
        //固定定位元素样式
        function fixedObjStyle() {
            var f_width = parseInt($('#footer').width());
            $('#footer').css('left', (h - f_width) / 2 + 'px');
        }

        fixedObjStyle()
    });
    //推广列表
    $(function(){
        function ListLoad(){};
        //页面到达底部
        ListLoad.prototype.pullBot = function(){
            var wh = $(window).height();
            var sct = $(window).scrollTop();
            var dh = $(document).height();
            if(wh+sct>dh-1){
                //到达底部
//                alert('ok');
                return true;
            }
            //没有
            return false;
        }
        var isLoading = false;
        var pageNum = 1
        ListLoad.prototype.getData = function(pgnum){
            var pgnum = pageNum||1;
            var url = '/api/game/promote/getList';
            var that = this;
            if(!isLoading){
                isLoading = true;
                ajaxHelper.get(url,{pageNum:pgnum},function(datas){
                    console.log(datas);
                    if(!datas.success){
                        alert(datas.msg);
                        return
                    }
                    var data = datas.obj.records
                    $('.numSz').html( datas.obj.total);
                    if(data.length){
                        var _html = "";
                        for(var i = 0;i<data.length;i++){
                            _html+='<tr>'+
                                    '<td>'+data[i].id+'</td>'+
                                    '<td>'+data[i].nickname+'</td>'+
                                    '<td>'+Util.formatDate(data[i].createTime)+'</td>'+
                                    '</tr>'
                        }
                        $(".tgListTable").append(_html);

                    }
                    isLoading = false;
                    pageNum++
                });
//                $.ajax({
//                    url:url,
//                    type:'GET',
//                    data:{pageNum:pgnum},
//                    success:function(datas){
//                        console.log(datas);
//                        if(!datas.success){
//                            alert(datas.msg);
//                            return
//                        }
//                        var data = datas.obj.records
//                        $('.numSz').html( datas.obj.total);
//                        if(data.length){
//                            var _html = "";
//                            for(var i = 0;i<data.length;i++){
//                                _html+='<tr>'+
//                                    '<td>'+data[i].id+'</td>'+
//                                    '<td>'+data[i].nickname+'</td>'+
//                                    '<td>'+Util.formatDate(data[i].createTime)+'</td>'+
//                                '</tr>'
//                            }
//                            $(".tgListTable").append(_html);
//
//                        }
//                        isLoading = false;
//                        pageNum++
//                    },
//                    beforeSend: function (request) {
//                        request.setRequestHeader("Authorization", 'bearer ' + oauth.getToken());
//                    },
//                    error:function(){
//                        layer.confirm('亲爱的玩家，您尚未登陆', {
//                            btn: ['去登录','取消'] //按钮
//                        }, function(){
//                            window.location.href = '/login.html';
//                        }, function(){
//
//                        });
//                    }
//                })
            }
        }
        var listLoad = new ListLoad();
        listLoad.getData(1);
        $(window).scroll(function(){
            var isbot = listLoad.pullBot();
            if(isbot){
                listLoad.getData();
            }
        })
    })
    //底部固定定位元素样式
    $(function(){
        var w = parseInt($(window).width());
        var iconW = parseInt($('.fixedIcon').width());
        if(w>500){
            $('.fixedIcon').css('left',(w+500)/2-iconW-20+'px');
        }

        $(window).resize(function(){
            var w = parseInt($(window).width());
            var iconW = parseInt($('.fixedIcon').width());
            if(w>500){
                $('.fixedIcon').css('left',(w+500)/2-iconW-20+'px');
            }
        })
    })
</script>